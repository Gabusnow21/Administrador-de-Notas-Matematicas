<div class="container mt-4">
  
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="text-primary"><i class="bi bi-list-check me-2"></i>Gestión de Actividades</h2>
    <a routerLink="/dashboard" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Volver
    </a>
  </div>

  <div class="card shadow-sm mb-4 bg-light border-primary">
    <div class="card-body">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label fw-bold">Selecciona Materia:</label>
          <select class="form-select" [(ngModel)]="selMateria" (change)="cargarActividades()">
            <option [ngValue]="0">-- Seleccionar --</option>
            @for (m of materias; track m.id) 
            { <option [ngValue]="m.id">{{ m.nombre }}</option> }
          </select>
        </div>
        <div class="col-md-6">
          <label class="form-label fw-bold">Selecciona Trimestre:</label>
          <select class="form-select" [(ngModel)]="selTrimestre" (change)="cargarActividades()">
            <option [ngValue]="0">-- Seleccionar --</option>
            @for (t of trimestres; track t.id)
             { <option [ngValue]="t.id">{{ t.nombre }}</option> }
          </select>
        </div>
      </div>
    </div>
  </div>

  @if (selMateria && selTrimestre) {
    <div class="row">
      
      <div class="col-md-4 mb-4">
        <div class="card shadow-sm sticky-top" style="top: 20px;">
          <div class="card-header bg-white py-3">
            <h5 class="card-title m-0 text-success">
              {{ esEdicion ? 'Editar Actividad' : 'Nueva Actividad' }}
            </h5>
          </div>
          <div class="card-body">
            <form (ngSubmit)="guardar()">
              <div class="mb-3">
                <label class="form-label">Nombre</label>
                <input type="text" class="form-control" [(ngModel)]="actividadForm.nombre" name="nombre" placeholder="Ej. Examen 1" required>
              </div>
              
              <div class="mb-3">
                <label class="form-label">Ponderación (%)</label>
                <input type="number" class="form-control" [(ngModel)]="actividadForm.ponderacion" name="ponderacion" placeholder="Ej. 20" required>
              </div>

              <div class="mb-3">
                <label class="form-label">Descripción</label>
                <textarea class="form-control" [(ngModel)]="actividadForm.descripcion" name="desc" rows="2"></textarea>
              </div>

              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-success" [disabled]="procesando">
                  {{ esEdicion ? 'Actualizar' : 'Guardar' }}
                </button>
                @if (esEdicion) {
                  <button type="button" class="btn btn-outline-secondary" (click)="cancelarEdicion()">Cancelar</button>
                }
              </div>
            </form>
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card shadow-sm">
          <div class="card-header bg-white">
            Actividades Registradas
          </div>
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th class="ps-4">Nombre</th>
                  <th>Pond.</th>
                  <th>Descripción</th>
                  <th class="text-end pe-4">Acciones</th>
                </tr>
              </thead>
              <tbody>
                @for (act of actividades; track act.id) {
                  <tr>
                    <td class="ps-4 fw-bold">{{ act.nombre }}</td>
                    <td><span class="badge bg-info text-dark">{{ act.ponderacion }}%</span></td>
                    <td class="small text-muted">{{ act.descripcion || '-' }}</td>
                    <td class="text-end pe-4">
                      <button class="btn btn-sm btn-outline-warning me-2" (click)="editar(act)">
                        <i class="bi bi-pencil-fill"></i>
                      </button>
                      <button class="btn btn-sm btn-outline-danger" (click)="eliminar(act)">
                        <i class="bi bi-trash-fill"></i>
                      </button>
                    </td>
                  </tr>
                }
                @if (actividades.length === 0) {
                  <tr><td colspan="4" class="text-center py-4 text-muted">No hay actividades creadas para este filtro.</td></tr>
                }
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </div>
  } @else {
    <div class="alert alert-info text-center py-5">
      <h4><i class="bi bi-arrow-up-circle me-2"></i>Selecciona Materia y Trimestre</h4>
      <p class="mb-0">Para gestionar actividades, primero debes indicar el contexto académico arriba.</p>
    </div>
  }

</div>