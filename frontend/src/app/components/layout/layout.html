<app-sidebar #sidebar></app-sidebar>
<div class="main-content-wrapper" [class.expanded]="sidebar.isExpanded">
  <nav class="navbar navbar-dark bg-primary shadow sticky-top">
    <div class="container-fluid">
      <div class="d-flex align-items-center">
        <span class="navbar-brand mb-0 h1 fw-bold">Administrador de Notas Matemáticas</span>
      </div>
      
      <div class="d-flex align-items-center position-relative">
        <button class="user-dropdown-btn shadow-sm" 
                (click)="toggleDropdown()" 
                type="button"
                aria-expanded="false">
           <span class="me-2 d-none d-md-inline fw-semibold">Bienvenido</span>
           <i class="bi bi-person-circle fs-3"></i>
        </button>

        <!-- Dropdown Menu -->
        <div class="dropdown-menu dropdown-menu-end shadow p-3" 
             [class.show]="isDropdownOpen" 
             style="position: absolute; top: 110%; right: 0; min-width: 250px; z-index: 1050;">
          
          <div class="mb-3 text-center border-bottom pb-2">
            <i class="bi bi-person-circle fs-1 text-primary mb-2"></i>
            <h6 class="mb-0 fw-bold text-dark">Usuario</h6>
            <small class="text-muted">{{ authService.getRole() }}</small>
          </div>

          <div class="d-grid gap-2">
             <button class="btn btn-sm w-100 text-start d-flex align-items-center justify-content-between" 
                    [class.btn-success]="syncService.isFullyOnline" 
                    [class.btn-warning]="!syncService.isFullyOnline && syncService.isOnline"
                    [class.btn-outline-secondary]="!(!syncService.isFullyOnline && syncService.isOnline) && !syncService.isFullyOnline"
                    (click)="forzarSincronizacion()">
              
              <div class="d-flex align-items-center">
                @if (!syncService.isFullyOnline && !syncService.isSyncing()) {
                  <i class="bi bi-wifi-off me-2"></i> <span>Offline</span>
                } 
                @else if (syncService.isSyncing()) {
                  <span class="spinner-border spinner-border-sm me-2"></span> <span>Sincronizando...</span>
                } 
                @else {
                  <i class="bi bi-cloud-check me-2"></i> <span>En Línea</span>
                }
              </div>
            </button>

            <button class="btn btn-sm btn-outline-danger w-100 text-start" (click)="logout()">
              <i class="bi bi-box-arrow-right me-2"></i>
              <span>Cerrar Sesión</span>
            </button>
          </div>

        </div>
        
        <!-- Overlay para cerrar al hacer clic fuera -->
        @if(isDropdownOpen) {
          <div class="dropdown-overlay" (click)="isDropdownOpen = false"></div>
        }

      </div>
    </div>
  </nav>
  <main class="p-4">
    <router-outlet></router-outlet>
  </main>
</div>
